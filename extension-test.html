<!DOCTYPE html>
<html>
<head>
    <title>Extension Setup & Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .section { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .primary { background: #007bff; color: white; border: none; border-radius: 4px; }
        .danger { background: #dc3545; color: white; border: none; border-radius: 4px; }
        .success-btn { background: #28a745; color: white; border: none; border-radius: 4px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        code { background: #f8f9fa; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Personal Recruiter Extension - Setup & Test</h1>
    
    <div class="section info">
        <h3>üìã Extension Information</h3>
        <p><strong>Extension ID:</strong> <code id="extensionId">Loading...</code></p>
        <p><strong>Authentication Mode:</strong> <span id="authMode">Checking...</span></p>
        <p><strong>Status:</strong> <span id="status">Checking...</span></p>
    </div>

    <div class="section warning">
        <h3>‚ö†Ô∏è OAuth Setup Required</h3>
        <p>The current OAuth client ID needs to be configured for your extension ID:</p>
        <ol>
            <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a></li>
            <li>Create/edit OAuth 2.0 Client ID</li>
            <li>Choose "Chrome Extension" type</li>
            <li>Use Extension ID: <code id="extensionIdCopy">Loading...</code></li>
            <li>Update manifest.json with new client ID</li>
        </ol>
        <button class="primary" onclick="copyExtensionId()">üìã Copy Extension ID</button>
    </div>

    <div class="section">
        <h3>üß™ Test Functions</h3>
        <button class="primary" onclick="testAuth()">Test Authentication</button>
        <button class="primary" onclick="checkAuthStatus()">Check Auth Status</button>
        <button class="danger" onclick="testLogout()">Test Logout</button>
        <button class="success-btn" onclick="clearAllData()">Clear All Data</button>
    </div>

    <div class="section">
        <h3>üìä Test Results</h3>
        <pre id="testResults">Ready for testing...</pre>
    </div>

    <script>
        const log = (message) => {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        };

        // Get extension info
        const extensionId = chrome.runtime.id;
        document.getElementById('extensionId').textContent = extensionId;
        document.getElementById('extensionIdCopy').textContent = extensionId;

        // Check current authentication mode
        const checkAuthMode = async () => {
            try {
                const response = await chrome.runtime.sendMessage({ action: 'ping' });
                if (response?.success) {
                    document.getElementById('authMode').textContent = 'Mock Authentication (for testing)';
                    document.getElementById('status').textContent = 'Ready for testing';
                }
            } catch (error) {
                document.getElementById('authMode').textContent = 'Unknown';
                document.getElementById('status').textContent = 'Error: ' + error.message;
            }
        };

        const copyExtensionId = () => {
            navigator.clipboard.writeText(extensionId);
            alert('Extension ID copied to clipboard!');
        };

        const testAuth = async () => {
            log('üîê Testing authentication...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'authenticate' });
                if (response?.success) {
                    log('‚úÖ Authentication successful!');
                    log(`User: ${response.data?.name} (${response.data?.email})`);
                } else {
                    log('‚ùå Authentication failed: ' + (response?.error || 'Unknown error'));
                }
            } catch (error) {
                log('‚ùå Authentication error: ' + error.message);
            }
        };

        const checkAuthStatus = async () => {
            log('üìä Checking authentication status...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'getAuthStatus' });
                if (response?.success) {
                    const isAuth = response.data?.isAuthenticated;
                    const user = response.data?.user;
                    log(`Status: ${isAuth ? 'Authenticated' : 'Not authenticated'}`);
                    if (user) {
                        log(`User: ${user.name} (${user.email})`);
                    }
                } else {
                    log('‚ùå Failed to get auth status: ' + (response?.error || 'Unknown error'));
                }
            } catch (error) {
                log('‚ùå Auth status error: ' + error.message);
            }
        };

        const testLogout = async () => {
            log('üö™ Testing logout...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'logout' });
                if (response?.success) {
                    log('‚úÖ Logout successful!');
                } else {
                    log('‚ùå Logout failed: ' + (response?.error || 'Unknown error'));
                }
            } catch (error) {
                log('‚ùå Logout error: ' + error.message);
            }
        };

        const clearAllData = async () => {
            log('üßπ Clearing all extension data...');
            try {
                await chrome.storage.sync.clear();
                await chrome.storage.local.clear();
                log('‚úÖ All data cleared!');
            } catch (error) {
                log('‚ùå Clear data error: ' + error.message);
            }
        };

        // Initialize
        checkAuthMode();
        log('Extension test page loaded');
        log(`Extension ID: ${extensionId}`);
    </script>
</body>
</html>
