<!DOCTYPE html>
<html>
<head>
    <title>Auth Mode Toggle</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .toggle-section { background: #f0f8ff; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .current-mode { background: #e8f5e8; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .warning { background: #fff3cd; padding: 15px; border-radius: 6px; margin: 10px 0; border-left: 4px solid #ffc107; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; }
        .mock-btn { background: #28a745; color: white; }
        .real-btn { background: #007bff; color: white; }
        .test-btn { background: #6f42c1; color: white; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üîß Authentication Mode Toggle</h1>
    
    <div class="current-mode">
        <h3>Current Mode: <span id="currentMode">Checking...</span></h3>
        <p>Extension ID: <code>bohmbphdflohbembblcjnjepamcp</code></p>
    </div>

    <div class="toggle-section">
        <h3>üß™ Mock Authentication (for testing)</h3>
        <p>Use fake Google user for testing extension features without OAuth setup.</p>
        <button class="mock-btn" onclick="setMockAuth()">Enable Mock Auth</button>
    </div>

    <div class="toggle-section">
        <h3>üîê Real Google OAuth</h3>
        <p>Use actual Google authentication (requires OAuth setup in Google Cloud Console).</p>
        <button class="real-btn" onclick="setRealAuth()">Enable Real OAuth</button>
    </div>

    <div class="toggle-section">
        <h3>üß™ Test Authentication</h3>
        <button class="test-btn" onclick="testAuth()">Test Current Auth</button>
        <button class="test-btn" onclick="testLogout()">Test Logout</button>
        <button class="test-btn" onclick="clearData()">Clear All Data</button>
    </div>

    <div class="warning">
        <strong>‚ö†Ô∏è Note:</strong> After changing mode, you must reload the extension in chrome://extensions/
    </div>

    <pre id="output">Ready for testing...</pre>

    <script>
        const log = (message) => {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        };

        const checkCurrentMode = async () => {
            try {
                // We can't directly read background.js, but we can test the behavior
                const response = await chrome.runtime.sendMessage({ action: 'authenticate' });
                
                if (response?.success && response.data?.email === 'test@example.com') {
                    document.getElementById('currentMode').textContent = 'Mock Authentication';
                    log('Current mode: Mock Authentication (Test User)');
                } else if (response?.success) {
                    document.getElementById('currentMode').textContent = 'Real Google OAuth';
                    log('Current mode: Real Google OAuth');
                } else {
                    document.getElementById('currentMode').textContent = 'Unknown/Error';
                    log('Current mode: Unknown or error occurred');
                }
            } catch (error) {
                document.getElementById('currentMode').textContent = 'Error';
                log('Error checking mode: ' + error.message);
            }
        };

        const setMockAuth = () => {
            log('üìù To enable mock authentication:');
            log('1. Open background.js');
            log('2. Find line: this.useMockAuth = false;');
            log('3. Change to: this.useMockAuth = true;');
            log('4. Reload extension in chrome://extensions/');
            log('');
            log('Copy this line to background.js line 4:');
            log('this.useMockAuth = true; // MOCK AUTH FOR TESTING');
        };

        const setRealAuth = () => {
            log('üîê To enable real Google OAuth:');
            log('1. Set up OAuth in Google Cloud Console (see GOOGLE_OAUTH_SETUP.md)');
            log('2. Open background.js');
            log('3. Find line: this.useMockAuth = true;');
            log('4. Change to: this.useMockAuth = false;');
            log('5. Update manifest.json with your OAuth client ID');
            log('6. Reload extension in chrome://extensions/');
            log('');
            log('Copy this line to background.js line 4:');
            log('this.useMockAuth = false; // REAL GOOGLE OAUTH');
        };

        const testAuth = async () => {
            log('üîê Testing authentication...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'authenticate' });
                if (response?.success) {
                    log('‚úÖ Authentication successful!');
                    log(`User: ${response.data?.name} (${response.data?.email})`);
                    log(`Picture: ${response.data?.picture ? 'Yes' : 'No'}`);
                } else {
                    log('‚ùå Authentication failed: ' + (response?.error || 'Unknown error'));
                }
            } catch (error) {
                log('‚ùå Authentication error: ' + error.message);
            }
        };

        const testLogout = async () => {
            log('üö™ Testing logout...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'logout' });
                if (response?.success) {
                    log('‚úÖ Logout successful!');
                } else {
                    log('‚ùå Logout failed: ' + (response?.error || 'Unknown error'));
                }
            } catch (error) {
                log('‚ùå Logout error: ' + error.message);
            }
        };

        const clearData = async () => {
            log('üßπ Clearing all data...');
            try {
                await chrome.storage.sync.clear();
                await chrome.storage.local.clear();
                log('‚úÖ All data cleared!');
            } catch (error) {
                log('‚ùå Clear error: ' + error.message);
            }
        };

        // Initialize
        setTimeout(checkCurrentMode, 1000);
        log('Auth mode toggle loaded');
    </script>
</body>
</html>
